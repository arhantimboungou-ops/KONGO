<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KONGO MARKET | Premium Africa</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { 
            --primary: #00df82; 
            --primary-dark: #00a862;
            --bg-dark: #0f172a;
            --accent: #38bdf8;
        }

        body { 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            background-color: #f1f5f9; 
            color: #1e293b;
            scroll-behavior: smooth;
        }

        .premium-card {
            background: white;
            border-radius: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(0,0,0,0.05);
            overflow: hidden;
        }

        .premium-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 40px -15px rgba(0,0,0,0.1);
        }

        .hero-gradient {
            background: radial-gradient(circle at top right, #00df82, #064e3b);
        }

        .glass-nav {
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-premium {
            background: var(--bg-dark);
            color: white;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .btn-premium:hover {
            background: #1e293b;
            transform: scale(1.02);
        }

        .category-pill {
            transition: all 0.2s;
            cursor: pointer;
            white-space: nowrap;
        }

        .category-pill:hover {
            background: var(--primary);
            color: white;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }

        /* Custom Checkbox/Radio */
        .tab-active {
            background: var(--primary) !important;
            color: white !important;
            box-shadow: 0 10px 15px -3px rgba(0, 223, 130, 0.3);
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-fade { animation: fadeIn 0.5s ease forwards; }
    </style>
</head>
<body class="antialiased">

    <!-- Header / Nav -->
    <nav class="sticky top-0 z-[100] glass-nav h-20">
        <div class="container mx-auto px-4 md:px-8 h-full flex justify-between items-center">
            <div class="flex items-center gap-3 cursor-pointer group" onclick="window.location.reload()">
                <div class="w-12 h-12 bg-emerald-500 rounded-2xl flex items-center justify-center text-white shadow-lg shadow-emerald-200 group-hover:rotate-12 transition-transform">
                    <i class="fas fa-crown text-xl"></i>
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tighter leading-none text-slate-900">KONGO<span class="text-emerald-500">MARKET</span></h1>
                    <p class="text-[9px] font-bold uppercase tracking-[0.3em] text-slate-400">Elite Marketplace</p>
                </div>
            </div>

            <div class="flex items-center gap-4">
                <div id="user-display" class="hidden flex items-center gap-3 bg-slate-100 rounded-2xl p-1.5 pr-4">
                    <div id="user-initial" class="w-9 h-9 bg-white rounded-xl flex items-center justify-center font-bold text-emerald-600 shadow-sm">?</div>
                    <span id="user-name" class="text-xs font-bold text-slate-700 hidden lg:inline">Mon Compte</span>
                    <button onclick="handleSignOut()" class="text-slate-400 hover:text-red-500 transition-colors"><i class="fas fa-power-off"></i></button>
                </div>

                <div id="guest-controls" class="flex items-center gap-2">
                    <button onclick="openAuthModal('login')" class="text-xs font-bold text-slate-600 uppercase tracking-widest px-4 hover:text-emerald-500 transition-colors">Connexion</button>
                    <button onclick="checkAuthAndOpenAdd()" class="btn-premium px-6 py-3.5 rounded-2xl font-bold text-[11px] uppercase tracking-widest shadow-xl flex items-center gap-2">
                        <i class="fas fa-plus"></i> Publier
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero Section -->
    <section class="relative pt-10 pb-20 px-4 overflow-hidden">
        <div class="container mx-auto text-center relative z-10">
            <span class="inline-block px-4 py-2 rounded-full bg-emerald-100 text-emerald-700 text-[10px] font-black uppercase tracking-widest mb-6 animate-fade">L'Afrique √† port√©e de clic</span>
            <h2 class="text-4xl md:text-6xl font-black text-slate-900 mb-6 tracking-tight animate-fade" style="animation-delay: 0.1s">
                Trouvez tout ce que <br><span class="text-emerald-500">vous cherchez.</span>
            </h2>
            
            <!-- Barre de Recherche Premium -->
            <div class="max-w-3xl mx-auto bg-white p-2 rounded-[2rem] shadow-2xl shadow-slate-200 flex flex-col md:flex-row gap-2 animate-fade" style="animation-delay: 0.2s">
                <div class="flex-1 flex items-center px-6 gap-3">
                    <i class="fas fa-search text-slate-300"></i>
                    <input type="text" id="search-input" placeholder="Que recherchez-vous ?" class="w-full py-4 outline-none font-medium text-slate-600">
                </div>
                <div class="h-12 w-px bg-slate-100 hidden md:block"></div>
                <select id="country-selector" onchange="filterAds()" class="px-6 py-4 bg-transparent outline-none font-bold text-slate-700 cursor-pointer">
                    <!-- Rempli par JS -->
                </select>
                <button onclick="filterAds()" class="bg-emerald-500 hover:bg-emerald-600 text-white px-8 py-4 rounded-[1.5rem] font-bold transition-all shadow-lg shadow-emerald-100">
                    Explorer
                </button>
            </div>

            <!-- Categories pills -->
            <div class="flex overflow-x-auto gap-3 mt-10 no-scrollbar justify-start md:justify-center pb-4 px-2 animate-fade" style="animation-delay: 0.3s" id="category-pills">
                <!-- Rempli par JS -->
            </div>
        </div>
        
        <!-- Background Decor -->
        <div class="absolute top-0 right-0 -mr-20 -mt-20 w-96 h-96 bg-emerald-50 rounded-full blur-3xl opacity-50"></div>
        <div class="absolute bottom-0 left-0 -ml-20 -mb-20 w-80 h-80 bg-blue-50 rounded-full blur-3xl opacity-50"></div>
    </section>

    <!-- Main Content -->
    <main class="container mx-auto px-4 md:px-8 pb-20">
        <div class="flex justify-between items-end mb-10">
            <div>
                <h3 class="text-2xl font-black text-slate-900">Annonces Premium</h3>
                <p class="text-slate-400 text-sm">Les meilleures offres s√©lectionn√©es pour vous</p>
            </div>
            <div class="hidden md:flex gap-2">
                <button class="w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center hover:bg-white transition-all"><i class="fas fa-chevron-left"></i></button>
                <button class="w-10 h-10 rounded-full border border-slate-200 flex items-center justify-center hover:bg-white transition-all"><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>

        <div id="ads-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-8">
            <!-- Loader -->
            <div class="col-span-full py-20 text-center">
                <div class="inline-block w-8 h-8 border-4 border-emerald-500 border-t-transparent rounded-full animate-spin"></div>
                <p class="mt-4 text-slate-400 font-bold text-xs uppercase tracking-widest">Chargement du catalogue...</p>
            </div>
        </div>
    </main>

    <!-- Modal Authentification -->
    <div id="modal-auth" class="fixed inset-0 bg-slate-950/80 backdrop-blur-md z-[200] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2.5rem] w-full max-w-[450px] p-8 md:p-10 shadow-2xl relative">
            <button onclick="closeAuthModal()" class="absolute right-8 top-8 text-slate-300 hover:text-slate-900 transition-colors"><i class="fas fa-times text-xl"></i></button>
            
            <div class="text-center mb-8">
                <div class="w-16 h-16 bg-emerald-50 text-emerald-500 rounded-2xl flex items-center justify-center mx-auto mb-4 text-2xl">
                    <i class="fas fa-user-shield"></i>
                </div>
                <h3 id="auth-title" class="text-2xl font-black text-slate-900">BIENVENUE</h3>
                <p class="text-slate-400 text-xs font-bold uppercase tracking-widest mt-1">Authentification s√©curis√©e</p>
            </div>

            <div class="flex bg-slate-100 p-1.5 rounded-2xl mb-8">
                <button id="tab-login" onclick="switchAuthTab('login')" class="flex-1 py-3 text-[10px] font-black uppercase rounded-xl transition-all tab-active">Connexion</button>
                <button id="tab-signup" onclick="switchAuthTab('signup')" class="flex-1 py-3 text-[10px] font-black uppercase rounded-xl transition-all text-slate-500">Rejoindre</button>
            </div>

            <div class="space-y-4">
                <div id="signup-name-container" class="hidden animate-fade">
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-4 mb-1 block">Nom complet</label>
                    <input type="text" id="auth-name" placeholder="Ex: Marc Antoine" class="w-full px-6 py-4 bg-slate-50 border-2 border-transparent rounded-2xl outline-none font-bold text-sm focus:border-emerald-500 transition-all">
                </div>

                <div class="flex gap-2 p-1.5 bg-slate-50 rounded-2xl">
                    <button onclick="setAuthMethod('phone')" id="btn-method-phone" class="flex-1 py-2.5 text-[10px] font-black uppercase rounded-xl transition-all bg-white shadow-sm text-emerald-600">T√©l√©phone</button>
                    <button onclick="setAuthMethod('email')" id="btn-method-email" class="flex-1 py-2.5 text-[10px] font-black uppercase rounded-xl transition-all text-slate-400">E-mail</button>
                </div>
                
                <div id="id-container" class="flex gap-3">
                    <select id="auth-prefix" class="bg-slate-50 px-4 rounded-2xl font-bold text-sm outline-none border-2 border-transparent focus:border-emerald-500 transition-all">
                        <!-- Rempli par JS -->
                    </select>
                    <input type="text" id="auth-identifier" placeholder="Votre num√©ro" class="w-full px-6 py-4 bg-slate-50 border-2 border-transparent rounded-2xl outline-none font-bold text-sm focus:border-emerald-500 transition-all">
                </div>

                <div>
                    <label class="text-[10px] font-bold text-slate-400 uppercase tracking-widest ml-4 mb-1 block">Mot de passe</label>
                    <input type="password" id="auth-pass" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full px-6 py-4 bg-slate-50 border-2 border-transparent rounded-2xl outline-none font-bold text-sm focus:border-emerald-500 transition-all">
                </div>

                <div id="auth-error" class="hidden bg-red-50 text-red-600 p-4 rounded-2xl text-[10px] font-bold uppercase text-center border border-red-100"></div>

                <button onclick="handleAuthSubmit()" id="btn-auth-action" class="w-full bg-slate-900 text-white py-5 rounded-2xl font-black uppercase tracking-[0.2em] shadow-xl hover:bg-emerald-600 transition-all text-xs mt-4">
                    Valider le profil
                </button>
            </div>
        </div>
    </div>

    <!-- Modals (Add, View) avec Design Premium... -->
    <!-- [Note: Logique Firebase identique √† V3 mais avec UI am√©lior√©e] -->

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp, query, orderBy } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQ2NSk-dOMeXnGupqQJflU9r6HurSeLHQ",
            authDomain: "kongo-market-3f7ce.firebaseapp.com",
            projectId: "kongo-market-3f7ce",
            storageBucket: "kongo-market-3f7ce.firebasestorage.app",
            messagingSenderId: "95509786102",
            appId: "1:95509786102:web:897c20a96e5911f75a2bd7"
        };

        const CATEGORIES = [
            { id: 'all', name: 'Tout voir', icon: 'fa-border-all' },
            { id: 'electro', name: '√âlectronique', icon: 'fa-laptop' },
            { id: 'auto', name: 'V√©hicules', icon: 'fa-car' },
            { id: 'immo', name: 'Immobilier', icon: 'fa-home' },
            { id: 'mode', name: 'Mode', icon: 'fa-tshirt' },
            { id: 'job', name: 'Emplois', icon: 'fa-briefcase' }
        ];

        const ALL_COUNTRIES = [
            { n: "Alg√©rie", c: "213" }, { n: "Angola", c: "244" }, { n: "B√©nin", c: "229" }, { n: "Botswana", c: "267" },
            { n: "Burkina Faso", c: "226" }, { n: "Burundi", c: "257" }, { n: "Cameroun", c: "237" }, { n: "Cap-Vert", c: "238" },
            { n: "Centrafrique", c: "236" }, { n: "Comores", c: "269" }, { n: "Congo (Brazzaville)", c: "242" }, { n: "Congo (Kinshasa)", c: "243" },
            { n: "C√¥te d'Ivoire", c: "225" }, { n: "Djibouti", c: "253" }, { n: "√âgypte", c: "20" }, { n: "√ârythr√©e", c: "291" },
            { n: "Eswatini", c: "268" }, { n: "√âthiopie", c: "251" }, { n: "Gabon", c: "241" }, { n: "Gambie", c: "220" },
            { n: "Ghana", c: "233" }, { n: "Guin√©e", c: "224" }, { n: "Guin√©e-Bissau", c: "245" }, { n: "Guin√©e √©quatoriale", c: "240" },
            { n: "Kenya", c: "254" }, { n: "Lesotho", c: "266" }, { n: "Lib√©ria", c: "231" }, { n: "Libye", c: "218" },
            { n: "Madagascar", c: "261" }, { n: "Malawi", c: "265" }, { n: "Mali", c: "223" }, { n: "Maroc", c: "212" },
            { n: "Maurice", c: "230" }, { n: "Mauritanie", c: "222" }, { n: "Mozambique", c: "258" }, { n: "Namibie", c: "264" },
            { n: "Niger", c: "227" }, { n: "Nig√©ria", c: "234" }, { n: "Ouganda", c: "256" }, { n: "Rwanda", c: "250" },
            { n: "Sao Tom√©-et-Principe", c: "239" }, { n: "S√©n√©gal", c: "221" }, { n: "Seychelles", c: "248" }, { n: "Sierra Leone", c: "232" },
            { n: "Somalie", c: "252" }, { n: "Soudan", c: "249" }, { n: "Soudan du Sud", c: "211" }, { n: "Tanzanie", c: "255" },
            { n: "Tchad", c: "235" }, { n: "Togo", c: "228" }, { n: "Tunisie", c: "216" }, { n: "Zambie", c: "260" }, { n: "Zimbabwe", c: "263" }
        ].sort((a,b) => a.n.localeCompare(b.n));

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        let currentUser = null;
        let selectedCategory = 'all';

        // Initialisation UI
        const initUI = () => {
            // Pays
            const countrySel = document.getElementById('country-selector');
            const prefixSel = document.getElementById('auth-prefix');
            countrySel.innerHTML = `<option value="all">üåç Toute l'Afrique</option>`;
            ALL_COUNTRIES.forEach(p => {
                countrySel.innerHTML += `<option value="${p.n}">${p.n}</option>`;
                prefixSel.innerHTML += `<option value="${p.c}">${p.n} (+${p.c})</option>`;
            });

            // Categories
            const catContainer = document.getElementById('category-pills');
            CATEGORIES.forEach(cat => {
                catContainer.innerHTML += `
                    <div onclick="selectCategory('${cat.id}')" id="pill-${cat.id}" class="category-pill bg-white px-6 py-3 rounded-2xl font-bold text-xs flex items-center gap-2 border border-slate-100 shadow-sm ${cat.id === 'all' ? 'tab-active' : ''}">
                        <i class="fas ${cat.icon}"></i> ${cat.name}
                    </div>
                `;
            });
        };

        window.selectCategory = (id) => {
            CATEGORIES.forEach(c => document.getElementById(`pill-${c.id}`).classList.remove('tab-active'));
            document.getElementById(`pill-${id}`).classList.add('tab-active');
            selectedCategory = id;
            filterAds();
        };

        // Auth Logic
        onAuthStateChanged(auth, (u) => {
            currentUser = u;
            document.getElementById('user-display').classList.toggle('hidden', !u);
            document.getElementById('guest-controls').classList.toggle('hidden', !!u);
            if(u) {
                document.getElementById('user-name').textContent = u.displayName || 'Compte';
                document.getElementById('user-initial').textContent = (u.displayName || 'U')[0].toUpperCase();
            }
            loadAds();
        });

        const loadAds = () => {
            const q = query(collection(db, 'ads'), orderBy('createdAt', 'desc'));
            onSnapshot(q, (snap) => {
                const grid = document.getElementById('ads-grid');
                grid.innerHTML = "";
                if(snap.empty) {
                    grid.innerHTML = `<div class="col-span-full py-20 text-center text-slate-400 font-bold uppercase text-xs tracking-widest">Aucune annonce disponible.</div>`;
                    return;
                }
                snap.forEach(doc => {
                    const ad = doc.data();
                    grid.innerHTML += `
                        <div class="premium-card animate-fade flex flex-col">
                            <div class="h-56 relative overflow-hidden">
                                <img src="${ad.image}" class="w-full h-full object-cover transform hover:scale-110 transition-transform duration-700">
                                <div class="absolute top-4 left-4 bg-white/90 backdrop-blur px-3 py-1.5 rounded-xl text-[9px] font-black uppercase text-emerald-600 shadow-sm">
                                    ${ad.category}
                                </div>
                            </div>
                            <div class="p-6 flex-1 flex flex-col">
                                <p class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mb-2"><i class="fas fa-map-marker-alt text-emerald-500 mr-1"></i> ${ad.country}</p>
                                <h4 class="text-lg font-bold text-slate-900 leading-tight mb-2 truncate">${ad.title}</h4>
                                <div class="mt-auto flex justify-between items-center">
                                    <span class="text-xl font-black text-emerald-600 tracking-tighter">${new Intl.NumberFormat().format(ad.price)} <small class="text-[10px]">FCFA</small></span>
                                    <button class="w-10 h-10 rounded-full bg-slate-900 text-white flex items-center justify-center hover:bg-emerald-500 transition-colors">
                                        <i class="fas fa-arrow-right text-xs"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                });
            });
        };

        // Auth handlers
        window.switchAuthTab = (tab) => {
            const isLogin = tab === 'login';
            document.getElementById('tab-login').className = `flex-1 py-3 text-[10px] font-black uppercase rounded-xl transition-all ${isLogin ? 'tab-active' : 'text-slate-500'}`;
            document.getElementById('tab-signup').className = `flex-1 py-3 text-[10px] font-black uppercase rounded-xl transition-all ${!isLogin ? 'tab-active' : 'text-slate-500'}`;
            document.getElementById('signup-name-container').classList.toggle('hidden', isLogin);
            window.authMode = tab;
        };

        window.setAuthMethod = (method) => {
            const isPhone = method === 'phone';
            document.getElementById('btn-method-phone').className = `flex-1 py-2.5 text-[10px] font-black uppercase rounded-xl transition-all ${isPhone ? 'bg-white shadow-sm text-emerald-600' : 'text-slate-400'}`;
            document.getElementById('btn-method-email').className = `flex-1 py-2.5 text-[10px] font-black uppercase rounded-xl transition-all ${!isPhone ? 'bg-white shadow-sm text-emerald-600' : 'text-slate-400'}`;
            document.getElementById('auth-prefix').classList.toggle('hidden', !isPhone);
            document.getElementById('auth-identifier').placeholder = isPhone ? "Votre num√©ro" : "votre@email.com";
            window.authMethod = method;
        };

        window.handleAuthSubmit = async () => {
            const ident = document.getElementById('auth-identifier').value.trim();
            const pass = document.getElementById('auth-pass').value;
            const name = document.getElementById('auth-name').value.trim();
            const prefix = document.getElementById('auth-prefix').value;
            const errorEl = document.getElementById('auth-error');

            errorEl.classList.add('hidden');
            if(!ident || pass.length < 6) {
                errorEl.textContent = "Champs invalides (Mdp 6 car. min)";
                errorEl.classList.remove('hidden');
                return;
            }

            let email = ident;
            if(window.authMethod === 'phone') email = `${prefix}${ident.replace(/\D/g,'')}@kongomarket.africa`;

            try {
                if(window.authMode === 'login') {
                    await signInWithEmailAndPassword(auth, email, pass);
                } else {
                    if(!name) throw new Error("Nom requis");
                    const res = await createUserWithEmailAndPassword(auth, email, pass);
                    await updateProfile(res.user, { displayName: name });
                }
                closeAuthModal();
            } catch (e) {
                errorEl.textContent = "Erreur d'authentification.";
                errorEl.classList.remove('hidden');
            }
        };

        window.openAuthModal = (mode) => { 
            window.authMode = mode; 
            window.authMethod = 'phone';
            switchAuthTab(mode); 
            document.getElementById('modal-auth').classList.remove('hidden'); 
        };
        window.closeAuthModal = () => document.getElementById('modal-auth').classList.add('hidden');
        window.handleSignOut = () => signOut(auth);
        window.checkAuthAndOpenAdd = () => currentUser ? alert("Lancement publication...") : openAuthModal('signup');

        initUI();
    </script>
</body>
</html>