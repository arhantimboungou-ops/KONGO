<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>KONGO MARKET | Plateforme d'Annonces Africaine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap');
        
        :root { --primary: #10b981; --slate-900: #0f172a; }
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #f8fafc; color: #1e293b; -webkit-font-smoothing: antialiased; }
        .premium-gradient { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        .ad-card { transition: all 0.3s ease; }
        .ad-card:hover { transform: translateY(-5px); box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1); }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .tab-active { color: var(--primary); border-bottom: 3px solid var(--primary); }
    </style>
</head>
<body class="overflow-x-hidden">

    <!-- Top Bar -->
    <div class="bg-emerald-600 text-white text-[10px] py-2 text-center font-bold uppercase tracking-widest px-4">
        Le marché n°1 pour publier vos annonces gratuitement en Afrique
    </div>

    <!-- Navigation -->
    <nav class="sticky top-0 z-[60] bg-white/90 backdrop-blur-md border-b border-slate-100">
        <div class="container mx-auto px-4 md:px-6 h-16 flex justify-between items-center">
            <div class="flex items-center gap-2 cursor-pointer" onclick="window.location.reload()">
                <div class="w-9 h-9 premium-gradient rounded-lg flex items-center justify-center text-white shadow-md">
                    <i class="fas fa-bullhorn"></i>
                </div>
                <h1 class="text-lg font-black tracking-tighter uppercase">KONGO<span class="text-emerald-600">MARKET</span></h1>
            </div>

            <div class="flex items-center gap-4">
                <div id="user-display" class="hidden flex items-center gap-2 bg-slate-50 border border-slate-200 rounded-full pl-2 pr-3 py-1">
                    <div class="w-6 h-6 premium-gradient text-white rounded-full flex items-center justify-center text-[9px] font-black" id="user-initial">?</div>
                    <span id="user-name" class="text-[11px] font-bold text-slate-800 hidden sm:inline">Utilisateur</span>
                    <button onclick="handleSignOut()" class="text-slate-300 hover:text-red-500"><i class="fas fa-power-off text-[10px]"></i></button>
                </div>

                <div id="guest-controls" class="flex items-center gap-3">
                    <button onclick="openAuthModal('login')" class="text-xs font-bold text-slate-600">Connexion</button>
                    <button onclick="checkAuthAndOpenAdd()" class="premium-gradient text-white px-4 py-2.5 rounded-xl font-bold text-[11px] shadow-lg flex items-center gap-2 uppercase tracking-wide">
                        <i class="fas fa-plus-circle text-xs"></i>
                        <span>Publier une annonce</span>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Hero & Search -->
    <header class="bg-white py-10 border-b border-slate-50">
        <div class="container mx-auto px-4 text-center">
            <h2 class="text-2xl md:text-4xl font-black text-slate-900 mb-6">Achetez et vendez en <span class="text-emerald-600">toute confiance</span>.</h2>
            
            <div class="max-w-5xl mx-auto space-y-3">
                <div class="bg-white p-2 rounded-2xl shadow-xl border border-slate-100 flex flex-col lg:flex-row gap-2">
                    <input type="text" id="search-input" placeholder="Que recherchez-vous ?" class="flex-[2] px-4 py-3 bg-slate-50 rounded-xl outline-none font-medium text-sm">
                    <select id="category-filter" class="flex-1 px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold text-sm appearance-none cursor-pointer"></select>
                    <select id="country-selector" class="flex-1 px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold text-sm appearance-none cursor-pointer"></select>
                    <button onclick="filterAds()" class="bg-slate-900 text-white px-6 py-3 rounded-xl font-black uppercase text-xs tracking-widest hover:bg-emerald-600 transition-colors">Filtrer</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Grid -->
    <main class="container mx-auto px-4 py-8">
        <div id="ads-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
            <div class="animate-pulse bg-slate-100 rounded-3xl h-64"></div>
            <div class="animate-pulse bg-slate-100 rounded-3xl h-64"></div>
            <div class="animate-pulse bg-slate-100 rounded-3xl h-64"></div>
            <div class="animate-pulse bg-slate-100 rounded-3xl h-64"></div>
        </div>
    </main>

    <!-- MODAL AUTH -->
    <div id="modal-auth" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-[420px] p-8 shadow-2xl relative">
            <button onclick="closeAuthModal()" class="absolute right-6 top-6 text-slate-400 hover:text-slate-900"><i class="fas fa-times"></i></button>
            
            <div class="flex gap-6 mb-6 border-b border-slate-100 justify-center">
                <button id="tab-login" onclick="switchAuthTab('login')" class="pb-3 text-xs font-black uppercase tracking-widest tab-active">Connexion</button>
                <button id="tab-signup" onclick="switchAuthTab('signup')" class="pb-3 text-xs font-black uppercase tracking-widest text-slate-300">Inscription</button>
            </div>

            <div class="space-y-4">
                <div id="signup-name-container" class="hidden">
                    <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Nom Complet</label>
                    <input type="text" id="auth-name" placeholder="Nom Prénom" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold border-2 border-transparent focus:border-emerald-500 text-sm">
                </div>

                <div>
                    <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Mode d'identification</label>
                    <div class="flex gap-2 mb-2">
                        <button onclick="setAuthType('phone')" id="type-phone" class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-emerald-500 bg-emerald-50 text-emerald-600">Numéro</button>
                        <button onclick="setAuthType('email')" id="type-email" class="flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-slate-100 text-slate-400">E-mail</button>
                    </div>
                    
                    <div class="flex gap-2" id="identifier-container">
                        <select id="auth-prefix" class="bg-slate-50 px-2 rounded-xl font-bold border-2 border-transparent text-xs">
                            <option value="242">+242</option><option value="243">+243</option><option value="237">+237</option><option value="225">+225</option><option value="221">+221</option><option value="241">+241</option><option value="229">+229</option><option value="228">+228</option>
                        </select>
                        <input type="text" id="auth-identifier" placeholder="Numéro" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold border-2 border-transparent focus:border-emerald-500 text-sm">
                    </div>
                </div>

                <div>
                    <div class="flex justify-between items-center mb-1">
                        <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Mot de passe</label>
                        <button onclick="forgotPassword()" class="text-[9px] font-bold text-emerald-600 uppercase hover:underline">Oublié ?</button>
                    </div>
                    <input type="password" id="auth-pass" placeholder="••••••••" class="w-full px-4 py-3 bg-slate-50 rounded-xl outline-none font-bold border-2 border-transparent focus:border-emerald-500 text-sm">
                </div>

                <button onclick="processAuth()" id="btn-auth-main" class="w-full bg-slate-900 text-white py-4 rounded-xl font-black uppercase tracking-widest mt-2 hover:bg-emerald-600 transition-colors shadow-lg">
                    Continuer
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL PUBLICATION -->
    <div id="modal-add" class="fixed inset-0 bg-slate-900/80 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-[550px] p-8 shadow-3xl overflow-y-auto max-h-[90vh] no-scrollbar">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-lg font-black text-slate-900 uppercase tracking-tighter">Nouvelle annonce</h2>
                <button onclick="closeAddModal()" class="text-slate-400 hover:text-red-500"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="space-y-4">
                <div class="relative cursor-pointer group" onclick="document.getElementById('ad-image-file').click()">
                    <input type="file" id="ad-image-file" class="hidden" accept="image/*" onchange="previewImage(this)">
                    <div id="preview-container" class="hidden absolute inset-0"><img id="image-preview" src="" class="w-full h-full object-cover rounded-xl"></div>
                    <div class="border-2 border-dashed border-slate-200 rounded-xl py-8 text-center bg-slate-50 group-hover:border-emerald-400 transition-colors">
                        <i class="fas fa-camera text-xl text-emerald-500 mb-1"></i>
                        <p class="text-[10px] font-black text-slate-400 uppercase">Photo du produit</p>
                    </div>
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <input type="text" id="ad-title" placeholder="Titre (ex: iPhone 13 Pro)" class="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold outline-none text-sm">
                    <input type="number" id="ad-price" placeholder="Prix (FCFA)" class="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold outline-none text-sm">
                </div>

                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <select id="ad-category" class="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold outline-none text-sm"></select>
                    <select id="ad-country" class="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold outline-none text-sm"></select>
                </div>

                <div>
                    <label class="text-[9px] font-black uppercase text-slate-400 ml-1">Contact WhatsApp</label>
                    <div class="flex gap-1 mt-1">
                        <select id="ad-whatsapp-prefix" class="bg-slate-50 px-2 rounded-xl font-bold text-xs outline-none border border-slate-100">
                            <option value="242">+242</option><option value="243">+243</option><option value="237">+237</option>
                        </select>
                        <input type="tel" id="ad-whatsapp" placeholder="Numéro sans l'indicatif" class="w-full px-4 py-3 bg-emerald-50 rounded-xl font-bold text-emerald-700 outline-none text-sm">
                    </div>
                </div>

                <textarea id="ad-desc" placeholder="Décrivez votre article en quelques mots..." class="w-full px-4 py-3 bg-slate-50 rounded-xl font-bold h-24 resize-none outline-none text-sm"></textarea>

                <button onclick="publishAd()" id="btn-publish" class="w-full premium-gradient text-white py-4 rounded-xl font-black uppercase shadow-xl hover:opacity-95 transition-opacity tracking-widest">
                    Mettre en ligne maintenant
                </button>
            </div>
        </div>
    </div>

    <!-- MODAL DETAIL -->
    <div id="modal-detail" class="fixed inset-0 bg-slate-900/90 backdrop-blur-md z-[100] hidden flex items-center justify-center p-4">
        <div class="bg-white rounded-[2rem] w-full max-w-4xl overflow-hidden shadow-2xl relative flex flex-col md:flex-row animate-[fadeIn_0.2s]">
            <button onclick="closeDetailModal()" class="absolute top-4 right-4 z-20 bg-black/20 text-white w-8 h-8 rounded-full hover:bg-black/50 transition-colors"><i class="fas fa-times"></i></button>
            <div class="w-full md:w-1/2 h-72 md:h-auto"><img id="detail-image" src="" class="w-full h-full object-cover"></div>
            <div class="w-full md:w-1/2 p-8 flex flex-col justify-between">
                <div>
                    <div class="flex gap-2 items-center">
                        <span id="detail-category" class="text-[9px] font-black uppercase bg-slate-100 px-2 py-0.5 rounded text-slate-500"></span>
                        <span id="detail-country" class="text-emerald-600 font-black text-[9px] uppercase bg-emerald-50 px-2 py-0.5 rounded"></span>
                    </div>
                    <h2 id="detail-title" class="text-2xl font-black text-slate-900 mt-3"></h2>
                    <div class="text-2xl font-black text-emerald-600 mt-1 mb-4" id="detail-price"></div>
                    <p id="detail-desc" class="text-slate-600 text-sm mb-6 leading-relaxed whitespace-pre-wrap"></p>
                </div>
                <div class="border-t border-slate-100 pt-6">
                    <p class="text-[9px] text-slate-400 font-bold uppercase mb-4">Vendeur: <span id="detail-seller" class="text-slate-900 ml-1"></span></p>
                    <a id="btn-whatsapp" href="#" target="_blank" class="w-full bg-[#25D366] text-white py-3.5 rounded-xl font-black flex items-center justify-center gap-3 uppercase tracking-widest text-xs shadow-lg hover:opacity-90 transition-opacity">
                        <i class="fab fa-whatsapp text-lg"></i> Contacter par WhatsApp
                    </a>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signInWithEmailAndPassword, createUserWithEmailAndPassword, updateProfile, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBQ2NSk-dOMeXnGupqQJflU9r6HurSeLHQ",
            authDomain: "kongo-market-3f7ce.firebaseapp.com",
            projectId: "kongo-market-3f7ce",
            storageBucket: "kongo-market-3f7ce.firebasestorage.app",
            messagingSenderId: "95509786102",
            appId: "1:95509786102:web:897c20a96e5911f75a2bd7"
        };

        const CATEGORIES = ["Immobilier", "Véhicules", "Électronique", "Mode & Beauté", "Maison & Jardin", "Services", "Emploi", "Divers"];
        const AFRICAN_COUNTRIES = [
            "Algérie", "Angola", "Bénin", "Botswana", "Burkina Faso", "Burundi", "Cameroun", "Cap-Vert", 
            "Centrafrique", "Comores", "Congo (Brazzaville)", "Congo (Kinshasa)", "Côte d'Ivoire", "Djibouti", 
            "Égypte", "Éthiopie", "Gabon", "Gambie", "Ghana", "Guinée", "Kenya", "Madagascar", "Mali", 
            "Maroc", "Maurice", "Mauritanie", "Mozambique", "Namibie", "Niger", "Nigeria", "Ouganda", 
            "Rwanda", "Sénégal", "Somalie", "Soudan", "Tanzanie", "Tchad", "Togo", "Tunisie", "Zambie", "Zimbabwe"
        ].sort();

        let app, auth, db, currentUser;
        let base64Image = "";
        let allAdsData = [];
        let authMode = 'login';
        let currentAuthType = 'phone'; // 'phone' or 'email'

        const init = () => {
            app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            db = getFirestore(app);

            // Populate selectors
            const selCatMain = document.getElementById('category-filter');
            const selCatAdd = document.getElementById('ad-category');
            selCatMain.add(new Option("Toutes les catégories", ""));
            CATEGORIES.forEach(c => {
                selCatMain.add(new Option(c, c));
                selCatAdd.add(new Option(c, c));
            });

            const selCountryMain = document.getElementById('country-selector');
            const selCountryAdd = document.getElementById('ad-country');
            selCountryMain.add(new Option("Toute l'Afrique", ""));
            AFRICAN_COUNTRIES.forEach(c => {
                selCountryMain.add(new Option(c, c));
                selCountryAdd.add(new Option(c, c));
            });

            onAuthStateChanged(auth, (user) => {
                currentUser = user;
                updateAuthUI(user);
                loadAds();
            });
        };

        const updateAuthUI = (user) => {
            const guest = document.getElementById('guest-controls');
            const member = document.getElementById('user-display');
            if (user) {
                guest.classList.add('hidden'); member.classList.remove('hidden');
                document.getElementById('user-name').textContent = user.displayName || 'Utilisateur';
                document.getElementById('user-initial').textContent = (user.displayName || 'U').charAt(0).toUpperCase();
            } else {
                guest.classList.remove('hidden'); member.classList.add('hidden');
            }
        };

        window.setAuthType = (type) => {
            currentAuthType = type;
            const btnPhone = document.getElementById('type-phone');
            const btnEmail = document.getElementById('type-email');
            const prefix = document.getElementById('auth-prefix');
            const input = document.getElementById('auth-identifier');

            if(type === 'phone') {
                btnPhone.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-emerald-500 bg-emerald-50 text-emerald-600";
                btnEmail.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-slate-100 text-slate-400";
                prefix.classList.remove('hidden');
                input.placeholder = "Numéro";
            } else {
                btnEmail.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-emerald-500 bg-emerald-50 text-emerald-600";
                btnPhone.className = "flex-1 py-2 text-[10px] font-black uppercase rounded-lg border-2 border-slate-100 text-slate-400";
                prefix.classList.add('hidden');
                input.placeholder = "Adresse e-mail";
            }
        };

        window.processAuth = async () => {
            const prefix = document.getElementById('auth-prefix').value;
            const ident = document.getElementById('auth-identifier').value.trim();
            const pass = document.getElementById('auth-pass').value;
            const name = document.getElementById('auth-name').value;

            if(!ident || !pass || (authMode === 'signup' && !name)) return alert("Veuillez remplir tous les champs.");

            let finalEmail = ident;
            if(currentAuthType === 'phone' || !ident.includes('@')) {
                const phoneOnly = ident.replace(/\D/g, '');
                finalEmail = (currentAuthType === 'phone' ? prefix : '') + phoneOnly + "@kongo.com";
            }

            const btn = document.getElementById('btn-auth-main');
            btn.disabled = true; btn.textContent = "Traitement...";

            try {
                if(authMode === 'login') {
                    await signInWithEmailAndPassword(auth, finalEmail, pass);
                } else {
                    const cred = await createUserWithEmailAndPassword(auth, finalEmail, pass);
                    await updateProfile(cred.user, { displayName: name });
                }
                closeAuthModal();
            } catch (e) { 
                let msg = "Erreur d'authentification.";
                if(e.code === 'auth/wrong-password') msg = "Mot de passe incorrect.";
                if(e.code === 'auth/user-not-found') msg = "Utilisateur non trouvé.";
                alert(msg);
            }
            finally { btn.disabled = false; btn.textContent = "Continuer"; }
        };

        window.forgotPassword = async () => {
            const ident = document.getElementById('auth-identifier').value.trim();
            if(!ident || !ident.includes('@')) return alert("Veuillez entrer une adresse e-mail valide pour réinitialiser votre mot de passe.");
            
            try {
                await sendPasswordResetEmail(auth, ident);
                alert("Un lien de réinitialisation a été envoyé à votre adresse e-mail.");
            } catch (e) {
                alert("Erreur : Impossible d'envoyer l'e-mail. Vérifiez l'adresse.");
            }
        };

        window.switchAuthTab = (tab) => {
            authMode = tab;
            const isLogin = tab === 'login';
            document.getElementById('signup-name-container').classList.toggle('hidden', isLogin);
            document.getElementById('tab-login').classList.toggle('tab-active', isLogin);
            document.getElementById('tab-signup').classList.toggle('tab-active', !isLogin);
        };

        const loadAds = () => {
            onSnapshot(collection(db, 'ads'), (snap) => {
                allAdsData = [];
                snap.forEach(doc => allAdsData.push({ id: doc.id, ...doc.data() }));
                allAdsData.sort((a,b) => (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0));
                renderAds(allAdsData);
            }, (err) => console.error("Erreur Firestore:", err));
        };

        const renderAds = (ads) => {
            const grid = document.getElementById('ads-grid');
            grid.innerHTML = ads.length ? "" : '<div class="col-span-full text-center py-20"><i class="fas fa-search text-3xl text-slate-200 mb-4 block"></i><p class="text-slate-400 font-bold uppercase text-[10px] tracking-widest">Aucune annonce trouvée</p></div>';
            ads.forEach(ad => {
                grid.innerHTML += `
                    <div onclick="openDetailModal('${ad.id}')" class="bg-white rounded-3xl overflow-hidden ad-card border border-slate-100 shadow-sm cursor-pointer flex flex-col">
                        <div class="h-52 bg-slate-50 overflow-hidden relative">
                            <img src="${ad.image}" class="w-full h-full object-cover">
                            <div class="absolute top-3 left-3 bg-white/90 backdrop-blur px-2 py-0.5 rounded text-[8px] font-black uppercase text-slate-500">${ad.category}</div>
                        </div>
                        <div class="p-4 flex-1">
                            <h4 class="font-bold text-slate-900 text-sm truncate">${ad.title}</h4>
                            <p class="text-emerald-600 font-black text-sm mt-1">${new Intl.NumberFormat('fr-FR').format(ad.price)} FCFA</p>
                            <div class="flex justify-between items-center mt-4 pt-3 border-t border-slate-50">
                                <span class="text-[9px] text-slate-400 font-bold uppercase"><i class="fas fa-map-marker-alt text-emerald-500 mr-1"></i> ${ad.country}</span>
                                <i class="fab fa-whatsapp text-emerald-500 text-sm"></i>
                            </div>
                        </div>
                    </div>`;
            });
        };

        window.filterAds = () => {
            const term = document.getElementById('search-input').value.toLowerCase();
            const country = document.getElementById('country-selector').value;
            const category = document.getElementById('category-filter').value;
            
            const filtered = allAdsData.filter(ad => {
                const matchTerm = ad.title.toLowerCase().includes(term);
                const matchCountry = country === "" || ad.country === country;
                const matchCategory = category === "" || ad.category === category;
                return matchTerm && matchCountry && matchCategory;
            });
            renderAds(filtered);
        };

        window.previewImage = (input) => {
            const file = input.files[0];
            if (file && file.size < 1000000) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    base64Image = e.target.result;
                    document.getElementById('image-preview').src = base64Image;
                    document.getElementById('preview-container').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            } else { alert("Image trop lourde ! (Max 1Mo)"); }
        };

        window.publishAd = async () => {
            const title = document.getElementById('ad-title').value;
            const price = document.getElementById('ad-price').value;
            const country = document.getElementById('ad-country').value;
            const category = document.getElementById('ad-category').value;
            const prefix = document.getElementById('ad-whatsapp-prefix').value;
            const whatsapp = document.getElementById('ad-whatsapp').value;
            const desc = document.getElementById('ad-desc').value;

            if(!title || !price || !country || !category || !base64Image || !whatsapp) return alert("Veuillez remplir tous les champs obligatoires.");

            const finalWa = prefix + whatsapp.replace(/\D/g, '');
            const btn = document.getElementById('btn-publish');
            btn.disabled = true; btn.textContent = "Publication en cours...";

            try {
                await addDoc(collection(db, "ads"), {
                    title, price: Number(price), country, category, whatsapp: finalWa, description: desc,
                    image: base64Image, userId: currentUser.uid, userName: currentUser.displayName, createdAt: serverTimestamp()
                });
                closeAddModal(); alert("Annonce publiée avec succès !");
            } catch (e) { alert("Erreur lors de la publication."); }
            finally { btn.disabled = false; btn.textContent = "Mettre en ligne maintenant"; }
        };

        window.openDetailModal = (id) => {
            const ad = allAdsData.find(a => a.id === id);
            document.getElementById('detail-image').src = ad.image;
            document.getElementById('detail-title').textContent = ad.title;
            document.getElementById('detail-price').textContent = new Intl.NumberFormat('fr-FR').format(ad.price) + ' FCFA';
            document.getElementById('detail-desc').textContent = ad.description || "Aucune description.";
            document.getElementById('detail-country').textContent = ad.country;
            document.getElementById('detail-category').textContent = ad.category;
            document.getElementById('detail-seller').textContent = ad.userName;
            document.getElementById('btn-whatsapp').href = `https://wa.me/${ad.whatsapp}`;
            document.getElementById('modal-detail').classList.remove('hidden');
        };

        window.handleSignOut = () => signOut(auth);
        window.openAuthModal = () => document.getElementById('modal-auth').classList.remove('hidden');
        window.closeAuthModal = () => document.getElementById('modal-auth').classList.add('hidden');
        window.closeDetailModal = () => document.getElementById('modal-detail').classList.add('hidden');
        window.openAddModal = () => document.getElementById('modal-add').classList.remove('hidden');
        window.closeAddModal = () => {
            document.getElementById('modal-add').classList.add('hidden');
            base64Image = "";
            document.getElementById('preview-container').classList.add('hidden');
        };
        window.checkAuthAndOpenAdd = () => currentUser ? openAddModal() : openAuthModal();

        init();
    </script>
</body>
</html>